# ุฏููู ูุญุต ุงูุชุญุณููุงุช - Testing Guide

## ๐ ููุฎุต ุงูุชุญุณููุงุช ุงููุทุจูุฉ

### โ 1. ุชุญุณููุงุช ุงูุฃุฏุงุก (Performance)
- ุฅุฒุงูุฉ duplicate `rescanProjectSnapshot` calls
- ุชูููู logging (ูู 5 ูุดุงุฑูุน ุจุฏูุงู ูู ูู ูุดุฑูุน)
- ุชุญุณูู rate limiting (sleep ูู ูุดุฑูุนูู ุจุฏูุงู ูู 3)
- ุชุญุณูู batch writing ูู Snapshot

### โ 2. ุชุญุณููุงุช Snapshot
- ุฅุถุงูุฉ rate limiting (sleep ูู 20 ูุฌูุฏ)
- ุชุญุณูู batch writing (chunks ูู 5000 ุตู)
- ุฅุฒุงูุฉ folder verification ุงููุณุจู ูู `insertPermissionSafely`

---

## ๐งช ุฎุทูุงุช ุงููุญุต

### 1๏ธโฃ ูุญุต ุชุญุณููุงุช ุงูุฃุฏุงุก (Apply to All Projects)

#### ุงูุทุฑููุฉ 1: ูู ุงููุงุฌูุฉ (UI)
1. ุงูุชุญ ุงูููุจ ุขุจ (Web App)
2. ุงุฐูุจ ุฅูู ุชุจููุจ **"Folder Structure"**
3. ุงุถุบุท ุนูู ุฒุฑ **"Apply to All Projects"**
4. ุฑุงูุจ:
   - โฑ๏ธ **ุงูููุช ุงููุณุชุบุฑู**: ูุฌุจ ุฃู ูููู ุฃุณุฑุน ูู ูุจู
   - ๐ **ุนุฏุฏ ุงููุดุงุฑูุน ุงููุนุงูุฌุฉ**: ูุฌุจ ุฃู ูุนุงูุฌ ุฃูุซุฑ ูู ููุณ ุงูููุช
   - ๐ **ุงูู Logs**: ูุฌุจ ุฃู ุชููู ุฃูู (ูู 5 ูุดุงุฑูุน ุจุฏูุงู ูู ูู ูุดุฑูุน)

#### ุงูุทุฑููุฉ 2: ูู Logs (ุงูุฃูุถู)
1. ุงูุชุญ **Apps Script Editor**
2. ุงุฐูุจ ุฅูู **Executions** (ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ)
3. ุงุจุญุซ ุนู ุขุฎุฑ execution ูู `applyLimitedAccessToAllProjects`
4. ุงูุชุญ ุงูู execution ูุงูุญุต:
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Processing project 1`, `Processing project 6`, `Processing project 11` (ูู 5 ูุดุงุฑูุน)
   - โ **ูุฌุจ ุฃูุง ุชุฑู**: `Processing project 1`, `Processing project 2`, `Processing project 3` (ูู ูุดุฑูุน)
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Updated snapshot for project` ูุฑุฉ ูุงุญุฏุฉ ููุท ููู ูุดุฑูุน (ููุณ ูุฑุชูู)
   - โฑ๏ธ **ุงูููุช ุงูุฅุฌูุงูู**: ูุฌุจ ุฃู ูููู ุฃูู ูู ูุจู

#### ุงูุทุฑููุฉ 3: ูู Console (ููุชุญูู ูู Rate Limiting)
1. ุงูุชุญ **Apps Script Editor**
2. ุงุฐูุจ ุฅูู **Executions**
3. ุงุจุญุซ ุนู execution ูุงูุญุต ุงูู logs:
   - โ ูุฌุจ ุฃู ุชุฑู `Utilities.sleep(300)` ูู ูุดุฑูุนูู
   - โ ูุฌุจ ุฃู ุชุฑู `Rate limiting: sleep every 2 projects`

---

### 2๏ธโฃ ูุญุต Snapshot

#### ุงูุทุฑููุฉ 1: ูุญุต Snapshot Sheet
1. ุงูุชุญ **Google Sheets** (Snapshot Spreadsheet)
2. ุงุฐูุจ ุฅูู sheet **"FolderSnapshot"**
3. ุงุถุบุท ุนูู ุฒุฑ **"Refresh Folders Snapshot"** ูู ุงููุงุฌูุฉ
4. ุฑุงูุจ:
   - โ **ูุฌุจ ุฃู ุชุธูุฑ ุงูุจูุงูุงุช**: ูุฌุจ ุฃู ุชููุฃ ุงูู sheet ุจุงูุจูุงูุงุช
   - โ **ุนุฏุฏ ุงูุตููู**: ูุฌุจ ุฃู ูููู ูุณุงููุงู ูุนุฏุฏ ุงููุฌูุฏุงุช ูู ุงููุดุงุฑูุน
   - โ **ุงูุฃุนูุฏุฉ**: ูุฌุจ ุฃู ุชุญุชูู ุนูู:
     - `projectCode`
     - `prNumber`
     - `folderId`
     - `folderPath`
     - `inheritedPermissionsDisabled`
     - `directGroups`
     - `templateLimitedAccess`
     - `lastScanned`

#### ุงูุทุฑููุฉ 2: ูุญุต Snapshot ูู Logs
1. ุงูุชุญ **Apps Script Editor**
2. ุงุฐูุจ ุฅูู **Executions**
3. ุงุจุญุซ ุนู ุขุฎุฑ execution ูู `scanDriveSnapshot`
4. ุงูุชุญ ุงูู execution ูุงูุญุต:
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Writing X rows to sheet in batches...`
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Rate limiting: sleep every 20 folders`
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Snapshot completed: X folders in Ys`
   - โฑ๏ธ **ุงูููุช**: ูุฌุจ ุฃู ูููู ูุนูููุงู (ูุนุชูุฏ ุนูู ุนุฏุฏ ุงููุฌูุฏุงุช)

#### ุงูุทุฑููุฉ 3: ูุญุต Snapshot Status
1. ูู ุงููุงุฌูุฉุ ุงุฐูุจ ุฅูู ุชุจููุจ **"Folder Scan"**
2. ุงุจุญุซ ุนู ูุณู **"Snapshot Management"**
3. ุงุถุบุท ุนูู **"Refresh Folders Snapshot"**
4. ุฑุงูุจ:
   - โ **ูุฌุจ ุฃู ุชุฑู**: ุฑุณุงูุฉ "Snapshot refresh started..."
   - โ **ูุฌุจ ุฃู ุชุฑู**: ุขุฎุฑ ููุช ุชุญุฏูุซ (lastUpdated)
   - โ **ูุฌุจ ุฃู ุชุฑู**: ุนุฏุฏ ุงูุตููู (totalRows)

---

### 3๏ธโฃ ูุญุต ุงูุตูุงุญูุงุช (Template Wins Rule)

#### ุงูุทุฑููุฉ 1: ูุญุต ูู Drive ูุจุงุดุฑุฉ
1. ุงูุชุญ **Google Drive**
2. ุงุฐูุจ ุฅูู ุฃู ูุดุฑูุน
3. ุงุฎุชุฑ ูุฌูุฏ ูู `limitedAccess = true` ูู Template
4. ุงุถุบุท **Right-click** โ **Share** โ **View permissions**
5. ุฑุงูุจ:
   - โ **ูุฌุจ ุฃู ุชุฑู**: ููุท ุงููุฌููุนุงุช ุงููุญุฏุฏุฉ ูู Template
   - โ **ูุฌุจ ุฃู ุชุฑู**: `inheritedPermissionsDisabled = true` (Limited Access enabled)
   - โ **ูุฌุจ ุฃูุง ุชุฑู**: ูุฌููุนุงุช ุฅุถุงููุฉ ุบูุฑ ููุฌูุฏุฉ ูู Template

#### ุงูุทุฑููุฉ 2: ูุญุต ูู Comparison
1. ูู ุงููุงุฌูุฉุ ุงุฐูุจ ุฅูู ุชุจููุจ **"Folder Scan"**
2. ุงุถุบุท ุนูู **"Compare with Template"**
3. ุฑุงูุจ:
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Matched: X` (ูุนุธู ุงููุฌูุฏุงุช ูุฌุจ ุฃู ุชููู matched)
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Mismatched: Y` (ูุฌุจ ุฃู ูููู ููููุงู ุฃู ุตูุฑ)
   - โ **ูุฌุจ ุฃู ุชุฑู**: ูู ุฌุฏูู Mismatched:
     - `Drive: Yes, Template: No` โ ูุฌุจ ุฃู ูููู ุตูุฑ ุจุนุฏ Apply to All
     - `Drive: No, Template: Yes` โ ูุฌุจ ุฃู ูููู ุตูุฑ ุจุนุฏ Apply to All

#### ุงูุทุฑููุฉ 3: ูุญุต ูู Logs
1. ุงูุชุญ **Apps Script Editor**
2. ุงุฐูุจ ุฅูู **Executions**
3. ุงุจุญุซ ุนู ุขุฎุฑ execution ูู `applyLimitedAccessToFolder`
4. ุงูุชุญ ุงูู execution ูุงูุญุต:
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Template says limitedAccess=true/false for folder`
   - โ **ูุฌุจ ุฃู ุชุฑู**: `Cleaned X group permission(s) from folder`
   - โ **ูุฌุจ ุฃู ุชุฑู**: `โ Applied [role] permission to group [email] on folder`
   - โ **ูุฌุจ ุฃู ุชุฑู**: `โ Successfully applied Limited Access to folder`

---

## ๐ ูุญุต ุงูุฃุฎุทุงุก ุงููุญุชููุฉ

### โ ูุดุงูู ูุญุชููุฉ ูู ุงูุฃุฏุงุก
- **ุฅุฐุง ูุงู ูุง ูุฒุงู ุจุทูุฆุงู**:
  - ุชุญูู ูู ุนุฏุฏ ุงููุดุงุฑูุน (ุฅุฐุง ูุงู ุฃูุซุฑ ูู 20ุ ูุฏ ูุญุชุงุฌ ููุช ุฃุทูู)
  - ุชุญูู ูู ุนุฏุฏ ุงููุฌูุฏุงุช ูู ูู ูุดุฑูุน (ุฅุฐุง ูุงู ุฃูุซุฑ ูู 50ุ ูุฏ ูุญุชุงุฌ ููุช ุฃุทูู)
  - ุชุญูู ูู ุงูู logs ููุฃุฎุทุงุก (rate limiting errors)

### โ ูุดุงูู ูุญุชููุฉ ูู Snapshot
- **ุฅุฐุง ูุงู Snapshot ูุงุฑุบุงู**:
  - ุชุญูู ูู ุฃู `getSnapshotSpreadsheet()` ูุนูู ุจุดูู ุตุญูุญ
  - ุชุญูู ูู ุฃู ุงูู sheet "FolderSnapshot" ููุฌูุฏ
  - ุชุญูู ูู ุงูู logs ููุฃุฎุทุงุก

### โ ูุดุงูู ูุญุชููุฉ ูู ุงูุตูุงุญูุงุช
- **ุฅุฐุง ูุงูุช ุงูุตูุงุญูุงุช ูุง ุชุทุจู**:
  - ุชุญูู ูู ุฃู Template ูุญุชูู ุนูู `limitedAccess = true/false`
  - ุชุญูู ูู ุฃู ุงููุฌููุนุงุช ููุฌูุฏุฉ ูู `GroupsAndAccess.gs`
  - ุชุญูู ูู ุงูู logs ููุฃุฎุทุงุก (permission errors)

---

## ๐ ููุงุฑูุฉ ูุจู ูุจุนุฏ

### ูุจู ุงูุชุญุณููุงุช:
- โฑ๏ธ **Apply to All Projects**: ~5-10 ุฏูุงุฆู ููู 20 ูุดุฑูุน
- ๐ **Logs**: ูู ูุดุฑูุน (20 log entries)
- ๐ **Snapshot**: ููุณุชุฏุนู ูุฑุชูู ููู ูุดุฑูุน
- โก **Rate Limiting**: sleep ูู 3 ูุดุงุฑูุน (200ms)

### ุจุนุฏ ุงูุชุญุณููุงุช:
- โฑ๏ธ **Apply to All Projects**: ~3-6 ุฏูุงุฆู ููู 20 ูุดุฑูุน (ุฃุณุฑุน ุจูุณุจุฉ 40-50%)
- ๐ **Logs**: ูู 5 ูุดุงุฑูุน (4 log entries ููุท)
- ๐ **Snapshot**: ููุณุชุฏุนู ูุฑุฉ ูุงุญุฏุฉ ููู ูุดุฑูุน
- โก **Rate Limiting**: sleep ูู 2 ูุดุงุฑูุน (300ms) - ุฃูุถู ุญูุงูุฉ ูู throttling

---

## โ Checklist ูููุญุต ุงููุงูู

- [ ] ูุญุต `applyLimitedAccessToAllProjects` ูู ุงููุงุฌูุฉ
- [ ] ูุญุต Logs ููุชุฃูุฏ ูู ุชูููู logging
- [ ] ูุญุต Snapshot Sheet ููุชุฃูุฏ ูู ูุฌูุฏ ุงูุจูุงูุงุช
- [ ] ูุญุต Snapshot Status ูู ุงููุงุฌูุฉ
- [ ] ูุญุต ุงูุตูุงุญูุงุช ูู Drive ูุจุงุดุฑุฉ
- [ ] ูุญุต Comparison ููุชุฃูุฏ ูู Template Wins
- [ ] ูุญุต Logs ููุชุฃูุฏ ูู ุชุทุจูู ุงูุตูุงุญูุงุช ุจุดูู ุตุญูุญ
- [ ] ูุญุต ุงูููุช ุงููุณุชุบุฑู (ูุฌุจ ุฃู ูููู ุฃุณุฑุน)

---

## ๐ ุฅุฐุง ูุงุฌูุช ูุดุงูู

1. **ุชุญูู ูู Logs**: ุงุฐูุจ ุฅูู Apps Script โ Executions โ ุงุจุญุซ ุนู ุขุฎุฑ execution
2. **ุชุญูู ูู ุงูุฃุฎุทุงุก**: ุงุจุญุซ ุนู `ERROR` ุฃู `WARN` ูู ุงูู logs
3. **ุชุญูู ูู Snapshot**: ุชุฃูุฏ ูู ุฃู Snapshot Spreadsheet ููุฌูุฏ ููุชุงุญ
4. **ุชุญูู ูู ุงูุตูุงุญูุงุช**: ุชุฃูุฏ ูู ุฃู ูุฏูู ุงูุตูุงุญูุงุช ุงููุงููุฉ (Domain Admin)

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

- **ุงูููุช ุงููุณุชุบุฑู ูุนุชูุฏ ุนูู**:
  - ุนุฏุฏ ุงููุดุงุฑูุน
  - ุนุฏุฏ ุงููุฌูุฏุงุช ูู ูู ูุดุฑูุน
  - ุณุฑุนุฉ ุงูุฅูุชุฑูุช
  - ุณุฑุนุฉ Google Drive API

- **ุงูุชุญุณููุงุช ุงูุฃูุซุฑ ุชุฃุซูุฑุงู**:
  - ุฅุฒุงูุฉ duplicate `rescanProjectSnapshot` (ูููุฑ ~30% ูู ุงูููุช)
  - ุชูููู logging (ูููุฑ ~10% ูู ุงูููุช)
  - ุชุญุณูู rate limiting (ูููู ุงูุฃุฎุทุงุก)

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก**: 2025-11-25
**ุขุฎุฑ ุชุญุฏูุซ**: 2025-11-25





